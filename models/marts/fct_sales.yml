version: 2

models:
  - name: fct_sales
    description: >
      Tabela fato de vendas no nível de item do pedido (salesorderdetailid).
      Consolida dados de pedidos, produtos, clientes, vendedor, geografia
      e métricas financeiras brutas e líquidas.
      Grão: 1 linha por item de pedido.
    columns:
      - name: salesorderdetailid
        description: "Identificador único da linha do pedido (grão da tabela fato)."
        tests:
          - not_null
          - unique

      - name: salesorderid
        description: "Identificador do pedido de venda."
        tests:
          - not_null

      - name: orderdate
        description: "Data em que o pedido foi realizado."
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('dim_tempo')
                field: orderdate

      - name: customerid
        description: "Identificador do cliente."
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('dim_cliente')
                field: customerid

      - name: status
        description: "Status do pedido de venda."

      - name: territoryid
        description: "Identificador do território de vendas."
        tests:
          - relationships:
              arguments:
                to: ref('dim_territorio')
                field: territoryid

      - name: cardtype
        description: "Tipo do cartão utilizado na compra, quando aplicável."

      - name: salesreason_name
        description: "Motivo da venda, quando aplicável (ex.: Promotion)."

      - name: productid
        description: "Identificador do produto vendido."
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('dim_produto')
                field: productid

      - name: specialofferid
        description: "Identificador da oferta especial aplicada, quando aplicável."

      - name: orderqty
        description: "Quantidade de unidades vendidas."
        tests:
          - not_null

      - name: unitprice
        description: "Preço unitário do produto no momento da venda."
        tests:
          - not_null

      - name: unitpricediscount
        description: "Percentual de desconto aplicado ao produto (0 a 1)."
        tests:
          - not_null

      - name: gross_sales
        description: "Valor bruto negociado por item: unitprice * orderqty."
        tests:
          - not_null

      - name: net_sales
        description: "Valor líquido negociado por item: unitprice * orderqty * (1 - unitpricediscount)."
        tests:
          - not_null

      - name: city
        description: "Cidade do endereço de entrega (ShipToAddress)."

      - name: state_name
        description: "Estado ou província do endereço de entrega (ShipToAddress)."

      - name: country_name
        description: "País ou região do endereço de entrega (ShipToAddress)."

      - name: salespersonid
        description: "Identificador do vendedor (BusinessEntityID), quando aplicável."

      - name: salesperson_name
        description: "Nome completo do vendedor, quando aplicável."
